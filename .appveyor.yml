version: 3.3.{build}
skip_tags: true
image: Visual Studio 2013
clone_depth: 1
clone_folder: c:\rssguard

environment:
  QTDIR: 'C:\Qt\5.7\msvc2013'
  QMAKESPEC: win32-msvc2013
  COMPILERBAT: '"C:\Program Files (x86)\Microsoft Visual Studio 12.0\VC\vcvarsall.bat" x86'
  access_token:
    secure: AdDF6ALWBJTln9VNrk6ghfnmiSa120+5PEyGCFvG9IWNBmvWbPmaIpJu0DBdZ1nj
   
build_script:
  - git submodule update --init --recursive
  - set "QT_PLUGIN_PATH=%QTDIR%\plugins"
  - set "PATH=%QTDIR%\bin;%PATH%"
  - '%COMPILERBAT%'
  - dir
  - cd ..
  - mkdir rssguard-build
  - cd rssguard-build
  - C:\Qt\5.7\msvc2013\bin\qmake.exe C:\rssguard
  - nmake
  - nmake windows_all
  
on_success:
  - git config --global credential.helper store
  - ps: Add-Content "$env:USERPROFILE\.git-credentials" "https://$($env:access_token):x-oauth-basic@github.com`n"
  - git config --global user.email "rotter.martinos@gmail.com"
  - git config --global user.name "martinrotter"
  - git clone https://github.com/martinrotter/rssguard-builds.git
  - copy /Y .\*.7z .\rssguard-builds
  - cd rssguard-builds
  - git add .\*.7z
  - git commit -a -m 'New files.'
  - git push origin master